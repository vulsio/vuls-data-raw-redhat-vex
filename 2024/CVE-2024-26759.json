{
	"document": {
		"aggregate_severity": {
			"namespace": "https://access.redhat.com/security/updates/classification/",
			"text": "moderate"
		},
		"category": "csaf_vex",
		"csaf_version": "2.0",
		"distribution": {
			"text": "Copyright Â© Red Hat, Inc. All rights reserved.",
			"tlp": {
				"label": "WHITE",
				"url": "https://www.first.org/tlp/"
			}
		},
		"lang": "en",
		"notes": [
			{
				"category": "legal_disclaimer",
				"text": "This content is licensed under the Creative Commons Attribution 4.0 International License (https://creativecommons.org/licenses/by/4.0/). If you distribute this content, or a modified version of it, you must provide attribution to Red Hat Inc. and provide a link to the original.",
				"title": "Terms of Use"
			}
		],
		"publisher": {
			"category": "vendor",
			"contact_details": "https://access.redhat.com/security/team/contact/",
			"issuing_authority": "Red Hat Product Security is responsible for vulnerability handling across all Red Hat offerings.",
			"name": "Red Hat Product Security",
			"namespace": "https://www.redhat.com"
		},
		"references": [
			{
				"category": "self",
				"summary": "Canonical URL",
				"url": "https://access.redhat.com/security/data/csaf/beta/vex/2024/cve-2024-26759.json"
			}
		],
		"title": "kernel: mm/swap: fix race when skipping swapcache",
		"tracking": {
			"current_release_date": "2024-04-16T10:57:51+00:00",
			"generator": {
				"date": "2024-04-16T10:57:51+00:00",
				"engine": {
					"name": "Red Hat SDEngine",
					"version": "3.28.1"
				}
			},
			"id": "CVE-2024-26759",
			"initial_release_date": "2024-04-03T00:00:00+00:00",
			"revision_history": [
				{
					"date": "2024-04-03T00:00:00+00:00",
					"number": "1",
					"summary": "Initial version"
				},
				{
					"date": "2024-04-16T10:29:02+00:00",
					"number": "2",
					"summary": "Current version"
				},
				{
					"date": "2024-04-16T10:57:51+00:00",
					"number": "3",
					"summary": "Last generated version"
				}
			],
			"status": "final",
			"version": "3"
		}
	},
	"product_tree": {
		"branches": [
			{
				"branches": [
					{
						"category": "product_name",
						"name": "Red Hat Enterprise Linux 6",
						"product": {
							"name": "Red Hat Enterprise Linux 6",
							"product_id": "red_hat_enterprise_linux_6",
							"product_identification_helper": {
								"cpe": "cpe:/o:redhat:enterprise_linux:6"
							}
						}
					},
					{
						"category": "product_name",
						"name": "Red Hat Enterprise Linux 7",
						"product": {
							"name": "Red Hat Enterprise Linux 7",
							"product_id": "red_hat_enterprise_linux_7",
							"product_identification_helper": {
								"cpe": "cpe:/o:redhat:enterprise_linux:7"
							}
						}
					},
					{
						"category": "product_name",
						"name": "Red Hat Enterprise Linux 8",
						"product": {
							"name": "Red Hat Enterprise Linux 8",
							"product_id": "red_hat_enterprise_linux_8",
							"product_identification_helper": {
								"cpe": "cpe:/o:redhat:enterprise_linux:8"
							}
						}
					},
					{
						"category": "product_name",
						"name": "Red Hat Enterprise Linux 9",
						"product": {
							"name": "Red Hat Enterprise Linux 9",
							"product_id": "red_hat_enterprise_linux_9",
							"product_identification_helper": {
								"cpe": "cpe:/o:redhat:enterprise_linux:9"
							}
						}
					},
					{
						"category": "product_version",
						"name": "kernel",
						"product": {
							"name": "kernel",
							"product_id": "kernel"
						}
					},
					{
						"category": "product_version",
						"name": "kernel-rt",
						"product": {
							"name": "kernel-rt",
							"product_id": "kernel-rt"
						}
					}
				],
				"category": "vendor",
				"name": "Red Hat"
			}
		],
		"relationships": [
			{
				"category": "default_component_of",
				"full_product_name": {
					"name": "kernel as a component of Red Hat Enterprise Linux 6",
					"product_id": "red_hat_enterprise_linux_6:kernel"
				},
				"product_reference": "kernel",
				"relates_to_product_reference": "red_hat_enterprise_linux_6"
			},
			{
				"category": "default_component_of",
				"full_product_name": {
					"name": "kernel as a component of Red Hat Enterprise Linux 7",
					"product_id": "red_hat_enterprise_linux_7:kernel"
				},
				"product_reference": "kernel",
				"relates_to_product_reference": "red_hat_enterprise_linux_7"
			},
			{
				"category": "default_component_of",
				"full_product_name": {
					"name": "kernel-rt as a component of Red Hat Enterprise Linux 7",
					"product_id": "red_hat_enterprise_linux_7:kernel-rt"
				},
				"product_reference": "kernel-rt",
				"relates_to_product_reference": "red_hat_enterprise_linux_7"
			},
			{
				"category": "default_component_of",
				"full_product_name": {
					"name": "kernel as a component of Red Hat Enterprise Linux 8",
					"product_id": "red_hat_enterprise_linux_8:kernel"
				},
				"product_reference": "kernel",
				"relates_to_product_reference": "red_hat_enterprise_linux_8"
			},
			{
				"category": "default_component_of",
				"full_product_name": {
					"name": "kernel-rt as a component of Red Hat Enterprise Linux 8",
					"product_id": "red_hat_enterprise_linux_8:kernel-rt"
				},
				"product_reference": "kernel-rt",
				"relates_to_product_reference": "red_hat_enterprise_linux_8"
			},
			{
				"category": "default_component_of",
				"full_product_name": {
					"name": "kernel as a component of Red Hat Enterprise Linux 9",
					"product_id": "red_hat_enterprise_linux_9:kernel"
				},
				"product_reference": "kernel",
				"relates_to_product_reference": "red_hat_enterprise_linux_9"
			},
			{
				"category": "default_component_of",
				"full_product_name": {
					"name": "kernel-rt as a component of Red Hat Enterprise Linux 9",
					"product_id": "red_hat_enterprise_linux_9:kernel-rt"
				},
				"product_reference": "kernel-rt",
				"relates_to_product_reference": "red_hat_enterprise_linux_9"
			}
		]
	},
	"vulnerabilities": [
		{
			"cve": "CVE-2024-26759",
			"cwe": {
				"id": "CWE-362",
				"name": "Concurrent Execution using Shared Resource with Improper Synchronization ('Race Condition')"
			},
			"discovery_date": "2024-04-03T00:00:00+00:00",
			"ids": [
				{
					"system_name": "Red Hat Bugzilla ID",
					"text": "2273204"
				}
			],
			"notes": [
				{
					"category": "description",
					"text": "In the Linux kernel, the following vulnerability has been resolved:\n\nmm/swap: fix race when skipping swapcache\n\nWhen skipping swapcache for SWP_SYNCHRONOUS_IO, if two or more threads\nswapin the same entry at the same time, they get different pages (A, B). \nBefore one thread (T0) finishes the swapin and installs page (A) to the\nPTE, another thread (T1) could finish swapin of page (B), swap_free the\nentry, then swap out the possibly modified page reusing the same entry. \nIt breaks the pte_same check in (T0) because PTE value is unchanged,\ncausing ABA problem.  Thread (T0) will install a stalled page (A) into the\nPTE and cause data corruption.\n\nOne possible callstack is like this:\n\nCPU0                                 CPU1\n----                                 ----\ndo_swap_page()                       do_swap_page() with same entry\n<direct swapin path>                 <direct swapin path>\n<alloc page A>                       <alloc page B>\nswap_read_folio() <- read to page A  swap_read_folio() <- read to page B\n<slow on later locks or interrupt>   <finished swapin first>\n...                                  set_pte_at()\n                                     swap_free() <- entry is free\n                                     <write to page B, now page A stalled>\n                                     <swap out page B to same swap entry>\npte_same() <- Check pass, PTE seems\n              unchanged, but page A\n              is stalled!\nswap_free() <- page B content lost!\nset_pte_at() <- staled page A installed!\n\nAnd besides, for ZRAM, swap_free() allows the swap device to discard the\nentry content, so even if page (B) is not modified, if swap_read_folio()\non CPU0 happens later than swap_free() on CPU1, it may also cause data\nloss.\n\nTo fix this, reuse swapcache_prepare which will pin the swap entry using\nthe cache flag, and allow only one thread to swap it in, also prevent any\nparallel code from putting the entry in the cache.  Release the pin after\nPT unlocked.\n\nRacers just loop and wait since it's a rare and very short event.  A\nschedule_timeout_uninterruptible(1) call is added to avoid repeated page\nfaults wasting too much CPU, causing livelock or adding too much noise to\nperf statistics.  A similar livelock issue was described in commit\n029c4628b2eb (\"mm: swap: get rid of livelock in swapin readahead\")\n\nReproducer:\n\nThis race issue can be triggered easily using a well constructed\nreproducer and patched brd (with a delay in read path) [1]:\n\nWith latest 6.8 mainline, race caused data loss can be observed easily:\n$ gcc -g -lpthread test-thread-swap-race.c && ./a.out\n  Polulating 32MB of memory region...\n  Keep swapping out...\n  Starting round 0...\n  Spawning 65536 workers...\n  32746 workers spawned, wait for done...\n  Round 0: Error on 0x5aa00, expected 32746, got 32743, 3 data loss!\n  Round 0: Error on 0x395200, expected 32746, got 32743, 3 data loss!\n  Round 0: Error on 0x3fd000, expected 32746, got 32737, 9 data loss!\n  Round 0 Failed, 15 data loss!\n\nThis reproducer spawns multiple threads sharing the same memory region\nusing a small swap device.  Every two threads updates mapped pages one by\none in opposite direction trying to create a race, with one dedicated\nthread keep swapping out the data out using madvise.\n\nThe reproducer created a reproduce rate of about once every 5 minutes, so\nthe race should be totally possible in production.\n\nAfter this patch, I ran the reproducer for over a few hundred rounds and\nno data loss observed.\n\nPerformance overhead is minimal, microbenchmark swapin 10G from 32G\nzram:\n\nBefore:     10934698 us\nAfter:      11157121 us\nCached:     13155355 us (Dropping SWP_SYNCHRONOUS_IO flag)\n\n[kasong@tencent.com: v4]\n  Link: https://lkml.kernel.org/r/20240219082040.7495-1-ryncsn@gmail.com",
					"title": "Vulnerability description"
				},
				{
					"category": "summary",
					"text": "kernel: mm/swap: fix race when skipping swapcache",
					"title": "Vulnerability summary"
				},
				{
					"category": "general",
					"text": "The CVSS score(s) listed for this vulnerability do not reflect the associated product's status, and are included for informational purposes to better understand the severity of this vulnerability.",
					"title": "CVSS score applicability"
				}
			],
			"product_status": {
				"known_affected": [
					"red_hat_enterprise_linux_6:kernel",
					"red_hat_enterprise_linux_7:kernel",
					"red_hat_enterprise_linux_7:kernel-rt"
				],
				"under_investigation": [
					"red_hat_enterprise_linux_8:kernel",
					"red_hat_enterprise_linux_8:kernel-rt",
					"red_hat_enterprise_linux_9:kernel",
					"red_hat_enterprise_linux_9:kernel-rt"
				]
			},
			"references": [
				{
					"category": "self",
					"summary": "Canonical URL",
					"url": "https://access.redhat.com/security/cve/CVE-2024-26759"
				},
				{
					"category": "external",
					"summary": "RHBZ#2273204",
					"url": "https://bugzilla.redhat.com/show_bug.cgi?id=2273204"
				},
				{
					"category": "external",
					"summary": "https://www.cve.org/CVERecord?id=CVE-2024-26759",
					"url": "https://www.cve.org/CVERecord?id=CVE-2024-26759"
				},
				{
					"category": "external",
					"summary": "https://nvd.nist.gov/vuln/detail/CVE-2024-26759",
					"url": "https://nvd.nist.gov/vuln/detail/CVE-2024-26759"
				},
				{
					"category": "external",
					"summary": "https://lore.kernel.org/linux-cve-announce/2024040304-CVE-2024-26759-45f1@gregkh/T",
					"url": "https://lore.kernel.org/linux-cve-announce/2024040304-CVE-2024-26759-45f1@gregkh/T"
				}
			],
			"release_date": "2024-04-03T00:00:00+00:00",
			"remediations": [
				{
					"category": "no_fix_planned",
					"details": "Out of support scope",
					"product_ids": [
						"red_hat_enterprise_linux_6:kernel",
						"red_hat_enterprise_linux_7:kernel",
						"red_hat_enterprise_linux_7:kernel-rt"
					]
				}
			],
			"scores": [
				{
					"cvss_v3": {
						"attackComplexity": "LOW",
						"attackVector": "LOCAL",
						"availabilityImpact": "HIGH",
						"baseScore": 5.5,
						"baseSeverity": "MEDIUM",
						"confidentialityImpact": "NONE",
						"integrityImpact": "NONE",
						"privilegesRequired": "LOW",
						"scope": "UNCHANGED",
						"userInteraction": "NONE",
						"vectorString": "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H",
						"version": "3.1"
					},
					"products": [
						"red_hat_enterprise_linux_6:kernel",
						"red_hat_enterprise_linux_7:kernel",
						"red_hat_enterprise_linux_7:kernel-rt",
						"red_hat_enterprise_linux_8:kernel",
						"red_hat_enterprise_linux_8:kernel-rt",
						"red_hat_enterprise_linux_9:kernel",
						"red_hat_enterprise_linux_9:kernel-rt"
					]
				}
			],
			"threats": [
				{
					"category": "impact",
					"details": "Moderate",
					"product_ids": [
						"red_hat_enterprise_linux_6:kernel",
						"red_hat_enterprise_linux_7:kernel",
						"red_hat_enterprise_linux_7:kernel-rt",
						"red_hat_enterprise_linux_8:kernel",
						"red_hat_enterprise_linux_8:kernel-rt",
						"red_hat_enterprise_linux_9:kernel",
						"red_hat_enterprise_linux_9:kernel-rt"
					]
				}
			],
			"title": "kernel: mm/swap: fix race when skipping swapcache"
		}
	]
}
