{
	"document": {
		"aggregate_severity": {
			"namespace": "https://access.redhat.com/security/updates/classification/",
			"text": "moderate"
		},
		"category": "csaf_vex",
		"csaf_version": "2.0",
		"distribution": {
			"text": "Copyright Â© Red Hat, Inc. All rights reserved.",
			"tlp": {
				"label": "WHITE",
				"url": "https://www.first.org/tlp/"
			}
		},
		"lang": "en",
		"notes": [
			{
				"category": "legal_disclaimer",
				"text": "This content is licensed under the Creative Commons Attribution 4.0 International License (https://creativecommons.org/licenses/by/4.0/). If you distribute this content, or a modified version of it, you must provide attribution to Red Hat Inc. and provide a link to the original.",
				"title": "Terms of Use"
			}
		],
		"publisher": {
			"category": "vendor",
			"contact_details": "https://access.redhat.com/security/team/contact/",
			"issuing_authority": "Red Hat Product Security is responsible for vulnerability handling across all Red Hat offerings.",
			"name": "Red Hat Product Security",
			"namespace": "https://www.redhat.com"
		},
		"references": [
			{
				"category": "self",
				"summary": "Canonical URL",
				"url": "https://access.redhat.com/security/data/csaf/v2/vex/2024/cve-2024-26792.json"
			}
		],
		"title": "kernel: btrfs: fix double free of anonymous device after snapshot creation failure",
		"tracking": {
			"current_release_date": "2024-08-02T14:57:44+00:00",
			"generator": {
				"date": "2024-08-02T14:57:44+00:00",
				"engine": {
					"name": "Red Hat SDEngine",
					"version": "3.31.1"
				}
			},
			"id": "CVE-2024-26792",
			"initial_release_date": "2024-04-04T00:00:00+00:00",
			"revision_history": [
				{
					"date": "2024-04-04T00:00:00+00:00",
					"number": "1",
					"summary": "Initial version"
				},
				{
					"date": "2024-07-05T15:25:43+00:00",
					"number": "2",
					"summary": "Current version"
				},
				{
					"date": "2024-08-02T14:57:44+00:00",
					"number": "3",
					"summary": "Last generated version"
				}
			],
			"status": "final",
			"version": "3"
		}
	},
	"product_tree": {
		"branches": [
			{
				"branches": [
					{
						"branches": [
							{
								"category": "product_name",
								"name": "Red Hat Enterprise Linux 6",
								"product": {
									"name": "Red Hat Enterprise Linux 6",
									"product_id": "red_hat_enterprise_linux_6",
									"product_identification_helper": {
										"cpe": "cpe:/o:redhat:enterprise_linux:6"
									}
								}
							}
						],
						"category": "product_family",
						"name": "Red Hat Enterprise Linux 6"
					},
					{
						"branches": [
							{
								"category": "product_name",
								"name": "Red Hat Enterprise Linux 7",
								"product": {
									"name": "Red Hat Enterprise Linux 7",
									"product_id": "red_hat_enterprise_linux_7",
									"product_identification_helper": {
										"cpe": "cpe:/o:redhat:enterprise_linux:7"
									}
								}
							}
						],
						"category": "product_family",
						"name": "Red Hat Enterprise Linux 7"
					},
					{
						"branches": [
							{
								"category": "product_name",
								"name": "Red Hat Enterprise Linux 8",
								"product": {
									"name": "Red Hat Enterprise Linux 8",
									"product_id": "red_hat_enterprise_linux_8",
									"product_identification_helper": {
										"cpe": "cpe:/o:redhat:enterprise_linux:8"
									}
								}
							}
						],
						"category": "product_family",
						"name": "Red Hat Enterprise Linux 8"
					},
					{
						"branches": [
							{
								"category": "product_name",
								"name": "Red Hat Enterprise Linux 9",
								"product": {
									"name": "Red Hat Enterprise Linux 9",
									"product_id": "red_hat_enterprise_linux_9",
									"product_identification_helper": {
										"cpe": "cpe:/o:redhat:enterprise_linux:9"
									}
								}
							}
						],
						"category": "product_family",
						"name": "Red Hat Enterprise Linux 9"
					},
					{
						"category": "product_version",
						"name": "kernel",
						"product": {
							"name": "kernel",
							"product_id": "kernel",
							"product_identification_helper": {
								"purl": "pkg:rpm/redhat/kernel?arch=src"
							}
						}
					},
					{
						"category": "product_version",
						"name": "kernel-rt",
						"product": {
							"name": "kernel-rt",
							"product_id": "kernel-rt",
							"product_identification_helper": {
								"purl": "pkg:rpm/redhat/kernel-rt?arch=src"
							}
						}
					}
				],
				"category": "vendor",
				"name": "Red Hat"
			}
		],
		"relationships": [
			{
				"category": "default_component_of",
				"full_product_name": {
					"name": "kernel as a component of Red Hat Enterprise Linux 6",
					"product_id": "red_hat_enterprise_linux_6:kernel"
				},
				"product_reference": "kernel",
				"relates_to_product_reference": "red_hat_enterprise_linux_6"
			},
			{
				"category": "default_component_of",
				"full_product_name": {
					"name": "kernel as a component of Red Hat Enterprise Linux 7",
					"product_id": "red_hat_enterprise_linux_7:kernel"
				},
				"product_reference": "kernel",
				"relates_to_product_reference": "red_hat_enterprise_linux_7"
			},
			{
				"category": "default_component_of",
				"full_product_name": {
					"name": "kernel-rt as a component of Red Hat Enterprise Linux 7",
					"product_id": "red_hat_enterprise_linux_7:kernel-rt"
				},
				"product_reference": "kernel-rt",
				"relates_to_product_reference": "red_hat_enterprise_linux_7"
			},
			{
				"category": "default_component_of",
				"full_product_name": {
					"name": "kernel as a component of Red Hat Enterprise Linux 8",
					"product_id": "red_hat_enterprise_linux_8:kernel"
				},
				"product_reference": "kernel",
				"relates_to_product_reference": "red_hat_enterprise_linux_8"
			},
			{
				"category": "default_component_of",
				"full_product_name": {
					"name": "kernel-rt as a component of Red Hat Enterprise Linux 8",
					"product_id": "red_hat_enterprise_linux_8:kernel-rt"
				},
				"product_reference": "kernel-rt",
				"relates_to_product_reference": "red_hat_enterprise_linux_8"
			},
			{
				"category": "default_component_of",
				"full_product_name": {
					"name": "kernel as a component of Red Hat Enterprise Linux 9",
					"product_id": "red_hat_enterprise_linux_9:kernel"
				},
				"product_reference": "kernel",
				"relates_to_product_reference": "red_hat_enterprise_linux_9"
			},
			{
				"category": "default_component_of",
				"full_product_name": {
					"name": "kernel-rt as a component of Red Hat Enterprise Linux 9",
					"product_id": "red_hat_enterprise_linux_9:kernel-rt"
				},
				"product_reference": "kernel-rt",
				"relates_to_product_reference": "red_hat_enterprise_linux_9"
			}
		]
	},
	"vulnerabilities": [
		{
			"cve": "CVE-2024-26792",
			"discovery_date": "2024-04-04T00:00:00+00:00",
			"flags": [
				{
					"label": "vulnerable_code_not_present",
					"product_ids": [
						"red_hat_enterprise_linux_6:kernel",
						"red_hat_enterprise_linux_7:kernel",
						"red_hat_enterprise_linux_7:kernel-rt",
						"red_hat_enterprise_linux_8:kernel",
						"red_hat_enterprise_linux_8:kernel-rt",
						"red_hat_enterprise_linux_9:kernel",
						"red_hat_enterprise_linux_9:kernel-rt"
					]
				}
			],
			"ids": [
				{
					"system_name": "Red Hat Bugzilla ID",
					"text": "2273446"
				}
			],
			"notes": [
				{
					"category": "description",
					"text": "In the Linux kernel, the following vulnerability has been resolved:\n\nbtrfs: fix double free of anonymous device after snapshot creation failure\n\nWhen creating a snapshot we may do a double free of an anonymous device\nin case there's an error committing the transaction. The second free may\nresult in freeing an anonymous device number that was allocated by some\nother subsystem in the kernel or another btrfs filesystem.\n\nThe steps that lead to this:\n\n1) At ioctl.c:create_snapshot() we allocate an anonymous device number\n   and assign it to pending_snapshot->anon_dev;\n\n2) Then we call btrfs_commit_transaction() and end up at\n   transaction.c:create_pending_snapshot();\n\n3) There we call btrfs_get_new_fs_root() and pass it the anonymous device\n   number stored in pending_snapshot->anon_dev;\n\n4) btrfs_get_new_fs_root() frees that anonymous device number because\n   btrfs_lookup_fs_root() returned a root - someone else did a lookup\n   of the new root already, which could some task doing backref walking;\n\n5) After that some error happens in the transaction commit path, and at\n   ioctl.c:create_snapshot() we jump to the 'fail' label, and after\n   that we free again the same anonymous device number, which in the\n   meanwhile may have been reallocated somewhere else, because\n   pending_snapshot->anon_dev still has the same value as in step 1.\n\nRecently syzbot ran into this and reported the following trace:\n\n  ------------[ cut here ]------------\n  ida_free called for id=51 which is not allocated.\n  WARNING: CPU: 1 PID: 31038 at lib/idr.c:525 ida_free+0x370/0x420 lib/idr.c:525\n  Modules linked in:\n  CPU: 1 PID: 31038 Comm: syz-executor.2 Not tainted 6.8.0-rc4-syzkaller-00410-gc02197fc9076 #0\n  Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 01/25/2024\n  RIP: 0010:ida_free+0x370/0x420 lib/idr.c:525\n  Code: 10 42 80 3c 28 (...)\n  RSP: 0018:ffffc90015a67300 EFLAGS: 00010246\n  RAX: be5130472f5dd000 RBX: 0000000000000033 RCX: 0000000000040000\n  RDX: ffffc90009a7a000 RSI: 000000000003ffff RDI: 0000000000040000\n  RBP: ffffc90015a673f0 R08: ffffffff81577992 R09: 1ffff92002b4cdb4\n  R10: dffffc0000000000 R11: fffff52002b4cdb5 R12: 0000000000000246\n  R13: dffffc0000000000 R14: ffffffff8e256b80 R15: 0000000000000246\n  FS:  00007fca3f4b46c0(0000) GS:ffff8880b9500000(0000) knlGS:0000000000000000\n  CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033\n  CR2: 00007f167a17b978 CR3: 000000001ed26000 CR4: 0000000000350ef0\n  Call Trace:\n   <TASK>\n   btrfs_get_root_ref+0xa48/0xaf0 fs/btrfs/disk-io.c:1346\n   create_pending_snapshot+0xff2/0x2bc0 fs/btrfs/transaction.c:1837\n   create_pending_snapshots+0x195/0x1d0 fs/btrfs/transaction.c:1931\n   btrfs_commit_transaction+0xf1c/0x3740 fs/btrfs/transaction.c:2404\n   create_snapshot+0x507/0x880 fs/btrfs/ioctl.c:848\n   btrfs_mksubvol+0x5d0/0x750 fs/btrfs/ioctl.c:998\n   btrfs_mksnapshot+0xb5/0xf0 fs/btrfs/ioctl.c:1044\n   __btrfs_ioctl_snap_create+0x387/0x4b0 fs/btrfs/ioctl.c:1306\n   btrfs_ioctl_snap_create_v2+0x1ca/0x400 fs/btrfs/ioctl.c:1393\n   btrfs_ioctl+0xa74/0xd40\n   vfs_ioctl fs/ioctl.c:51 [inline]\n   __do_sys_ioctl fs/ioctl.c:871 [inline]\n   __se_sys_ioctl+0xfe/0x170 fs/ioctl.c:857\n   do_syscall_64+0xfb/0x240\n   entry_SYSCALL_64_after_hwframe+0x6f/0x77\n  RIP: 0033:0x7fca3e67dda9\n  Code: 28 00 00 00 (...)\n  RSP: 002b:00007fca3f4b40c8 EFLAGS: 00000246 ORIG_RAX: 0000000000000010\n  RAX: ffffffffffffffda RBX: 00007fca3e7abf80 RCX: 00007fca3e67dda9\n  RDX: 00000000200005c0 RSI: 0000000050009417 RDI: 0000000000000003\n  RBP: 00007fca3e6ca47a R08: 0000000000000000 R09: 0000000000000000\n  R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000000000\n  R13: 000000000000000b R14: 00007fca3e7abf80 R15: 00007fff6bf95658\n   </TASK>\n\nWhere we get an explicit message where we attempt to free an anonymous\ndevice number that is not currently allocated. It happens in a different\ncode path from the example below, at btrfs_get_root_ref(), so this change\nmay not fix the case triggered by sy\n---truncated---",
					"title": "Vulnerability description"
				},
				{
					"category": "summary",
					"text": "kernel: btrfs: fix double free of anonymous device after snapshot creation failure",
					"title": "Vulnerability summary"
				},
				{
					"category": "general",
					"text": "The CVSS score(s) listed for this vulnerability do not reflect the associated product's status, and are included for informational purposes to better understand the severity of this vulnerability.",
					"title": "CVSS score applicability"
				}
			],
			"product_status": {
				"known_not_affected": [
					"red_hat_enterprise_linux_6:kernel",
					"red_hat_enterprise_linux_7:kernel",
					"red_hat_enterprise_linux_7:kernel-rt",
					"red_hat_enterprise_linux_8:kernel",
					"red_hat_enterprise_linux_8:kernel-rt",
					"red_hat_enterprise_linux_9:kernel",
					"red_hat_enterprise_linux_9:kernel-rt"
				]
			},
			"references": [
				{
					"category": "self",
					"summary": "Canonical URL",
					"url": "https://access.redhat.com/security/cve/CVE-2024-26792"
				},
				{
					"category": "external",
					"summary": "RHBZ#2273446",
					"url": "https://bugzilla.redhat.com/show_bug.cgi?id=2273446"
				},
				{
					"category": "external",
					"summary": "https://www.cve.org/CVERecord?id=CVE-2024-26792",
					"url": "https://www.cve.org/CVERecord?id=CVE-2024-26792"
				},
				{
					"category": "external",
					"summary": "https://nvd.nist.gov/vuln/detail/CVE-2024-26792",
					"url": "https://nvd.nist.gov/vuln/detail/CVE-2024-26792"
				},
				{
					"category": "external",
					"summary": "https://lore.kernel.org/linux-cve-announce/2024040401-CVE-2024-26792-6048@gregkh/T",
					"url": "https://lore.kernel.org/linux-cve-announce/2024040401-CVE-2024-26792-6048@gregkh/T"
				}
			],
			"release_date": "2024-04-04T00:00:00+00:00",
			"title": "kernel: btrfs: fix double free of anonymous device after snapshot creation failure"
		}
	]
}
